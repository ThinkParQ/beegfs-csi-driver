kind: StatefulSet
apiVersion: apps/v1
metadata:
  name: beegfs-fs-1
spec:
  serviceName: "beegfs-fs-1"
  replicas: 1
  selector:
    matchLabels:
      app: beegfs-fs-1
  template:
    metadata:
      annotations:
        kubectl.kubernetes.io/default-container: beegfs
      labels:
        app: beegfs-fs-1
    spec:
      hostNetwork: true # This is the easiest (but not necessarily the best) way for clients to access the file system.
      containers:
        - name: beegfs-mgmtd
          image: beegfs/beegfs-mgmtd:${BEEGFS_VERSION}
          args:
            - storeMgmtdDirectory=/mnt/mgmt_tgt_mgmt01
            - storeAllowFirstRunInit=false
          env:
            - name: beegfs_setup_1
              value: beegfs-setup-mgmtd -p /mnt/mgmt_tgt_mgmt01 -C -S mgmt_tgt_mgmt01
            - name: CONN_AUTH_FILE_DATA
              value: "${BEEGFS_SECRET}"
        - name: beegfs-meta
          image: beegfs/beegfs-meta:${BEEGFS_VERSION}
          args:
            - storeMetaDirectory=/mnt/meta_01_tgt_0101
            - storeAllowFirstRunInit=false
            - sysMgmtdHost=localhost
          env:
            - name: beegfs_setup_1
              value: beegfs-setup-meta -C -p /mnt/meta_01_tgt_0101 -s 1 -S meta_01
            - name: CONN_AUTH_FILE_DATA
              value: "${BEEGFS_SECRET}"
        - name: beegfs-storage
          image: beegfs/beegfs-storage:${BEEGFS_VERSION}
          args:
            - storeStorageDirectory=/mnt/stor_01_tgt_101,/mnt/stor_01_tgt_102
            - storeAllowFirstRunInit=false
            - sysMgmtdHost=localhost
          env:
            - name: beegfs_setup_1
              value: beegfs-setup-storage -C -p /mnt/stor_01_tgt_101 -s 1 -S stor_01_tgt_101 -i 101
            - name: beegfs_setup_2
              value: beegfs-setup-storage -C -p /mnt/stor_01_tgt_102 -s 1 -S stor_01_tgt_101 -i 102
            - name: CONN_AUTH_FILE_DATA
              value: "${BEEGFS_SECRET}"
